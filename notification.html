<!doctype html>
<html>
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Notifications — JHOM</title>
  <link rel="stylesheet" href="index.css">
  <script src="app-config.js"></script>
</head>
<body>
  <header class="header"><div class="brand"><img src="logo.jpg"> Notifications</div><nav><a class="btn btn-outline" href="index.html">Account</a></nav></header>
  <main class="container"><section class="card"><h2>Your Notifications</h2><div id="notifList"></div></section></main>
  <footer class="footer">© 2025 JHOM</footer>

  <script>
    function getCurrentUser(){ return JSON.parse(localStorage.getItem('currentUser')||'null') }
    async function loadNotifications(){
      const out = document.getElementById('notifList');
      try {
        const res = await fetch(BACKEND_URL + '/bookings');
        const bookings = await res.json();
        const me = getCurrentUser();
        const visible = me ? bookings.filter(b => (b.user && b.user.email === me.email) || (b.room?.id && true)) : bookings;
        if(!visible.length){ out.innerHTML = '<div class="kv">No notifications</div>'; return; }
        out.innerHTML = visible.map(b=>`
          <div class="card">
            <div style="display:flex;justify-content:space-between"><strong>${b.fullName}</strong><span class="badge">${b.status||'Pending'}</span></div>
            <div class="kv">${b.room?.name||b.roomName} • ${b.checkIn}</div>
            ${b.pin?`<div class="kv">Pin: ${b.pin}</div>`:''}
            <div class="kv">Ref: ${b.ticketRef||''}</div>
          </div>
        `).join('');
      } catch {
        out.innerHTML = '<div class="kv">Failed to load notifications</div>';
      }
    }
    loadNotifications();
  </script>
</body>
</html>
